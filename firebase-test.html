<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test - Desa Website</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>
    <style>
        body { font-family: Arial; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h1 { color: #1a4d2e; }
        .test-box { background: #f9f9f9; border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { background: #1a4d2e; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0f3620; }
        textarea, input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        code { background: #f5f5f5; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
        .response { background: #f9f9f9; border-left: 4px solid #1a4d2e; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; word-break: break-word; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Firebase Connection Test</h1>
        <p>Tool ini membantu Anda test koneksi Firebase dan debug issues.</p>

        <!-- Status Firebase -->
        <div class="test-box">
            <h3>1Ô∏è‚É£ Status Koneksi Firebase</h3>
            <button onclick="testFirebaseConnection()">Test Koneksi</button>
            <div id="connectionStatus"></div>
        </div>

        <!-- Read Data -->
        <div class="test-box">
            <h3>2Ô∏è‚É£ Baca Data dari Firebase</h3>
            <button onclick="readFirebaseData()">Baca Semua Data</button>
            <div id="readResult"></div>
        </div>

        <!-- Write Test Data -->
        <div class="test-box">
            <h3>3Ô∏è‚É£ Tulis Data Test</h3>
            <input type="text" id="testTitle" placeholder="Judul Berita Test">
            <textarea id="testContent" placeholder="Isi Berita Test" rows="3"></textarea>
            <button onclick="writeTestData()">Tulis Data Test</button>
            <div id="writeResult"></div>
        </div>

        <!-- Clear Test Data -->
        <div class="test-box">
            <h3>4Ô∏è‚É£ Hapus Data Test</h3>
            <button onclick="clearTestData()" style="background: #dc3545;">Hapus Semua Data Test</button>
            <div id="clearResult"></div>
        </div>

        <!-- Config Check -->
        <div class="test-box">
            <h3>5Ô∏è‚É£ Cek Firebase Config</h3>
            <button onclick="checkConfig()">Cek Config</button>
            <div id="configResult"></div>
        </div>

        <hr>
        <p style="color: #666; font-size: 12px;">
            üí° Tip: Buka Developer Tools (F12) ‚Üí Console untuk melihat log detil.<br>
            ‚ö†Ô∏è Catatan: Halaman ini hanya untuk testing, jangan gunakan di production.
        </p>
    </div>

    <script>
        // Load Firebase Config
        let firebaseConfig = null;
        let database = null;

        // Import config from firebase-config.js
        const script = document.createElement('script');
        script.src = 'firebase-config.js';
        script.onload = () => {
            // Setelah firebase-config.js loaded, database sudah siap
            console.log("Firebase Config loaded");
        };
        script.onerror = () => {
            showStatus("configResult", "Error: Tidak bisa load firebase-config.js", "error");
        };
        document.head.appendChild(script);

        function showStatus(elementId, message, type = "info") {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        async function testFirebaseConnection() {
            try {
                // Cek apakah Firebase sudah initialized
                if (typeof firebase === 'undefined' || !firebase.apps.length) {
                    showStatus("connectionStatus", "‚ùå Firebase tidak ter-initialize. Cek firebase-config.js", "error");
                    return;
                }

                database = firebase.database();
                
                // Try simple read
                const ref = firebase.database().ref('desa');
                const snapshot = await ref.get();
                
                if (snapshot.exists()) {
                    showStatus("connectionStatus", "‚úÖ Koneksi Firebase BERHASIL! Database terkoneksi.", "success");
                } else {
                    showStatus("connectionStatus", "‚ö†Ô∏è Koneksi OK tapi data tidak ada. Pastikan struktur 'desa' sudah dibuat.", "info");
                }
            } catch (error) {
                showStatus("connectionStatus", `‚ùå Error: ${error.message}`, "error");
            }
        }

        async function readFirebaseData() {
            try {
                if (!database) database = firebase.database();
                
                const ref = firebase.database().ref('desa');
                const snapshot = await ref.get();
                
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    showStatus("readResult", `‚úÖ Data berhasil dibaca:\n${JSON.stringify(data, null, 2)}`, "success");
                } else {
                    showStatus("readResult", "‚ùå Tidak ada data di 'desa'. Buat struktur database dulu.", "error");
                }
            } catch (error) {
                showStatus("readResult", `‚ùå Error: ${error.message}`, "error");
            }
        }

        async function writeTestData() {
            try {
                const title = document.getElementById("testTitle").value;
                const content = document.getElementById("testContent").value;
                
                if (!title || !content) {
                    showStatus("writeResult", "‚ùå Isi semua field dulu!", "error");
                    return;
                }

                if (!database) database = firebase.database();
                
                const testId = "test_" + Date.now();
                const ref = firebase.database().ref(`desa/news/${testId}`);
                
                await ref.set({
                    id: testId,
                    title: title,
                    content: content,
                    date: new Date().toISOString().split('T')[0],
                    category: "Test",
                    image: "https://via.placeholder.com/400x300?text=Test"
                });
                
                showStatus("writeResult", `‚úÖ Data test berhasil ditulis dengan ID: ${testId}`, "success");
                document.getElementById("testTitle").value = "";
                document.getElementById("testContent").value = "";
            } catch (error) {
                showStatus("writeResult", `‚ùå Error: ${error.message}`, "error");
            }
        }

        async function clearTestData() {
            try {
                if (!database) database = firebase.database();
                
                const ref = firebase.database().ref('desa/news');
                const snapshot = await ref.get();
                
                if (!snapshot.exists()) {
                    showStatus("clearResult", "‚ùå Tidak ada data untuk dihapus", "info");
                    return;
                }

                let deletedCount = 0;
                const data = snapshot.val();
                
                for (const key in data) {
                    if (key.startsWith("test_")) {
                        await firebase.database().ref(`desa/news/${key}`).remove();
                        deletedCount++;
                    }
                }
                
                if (deletedCount > 0) {
                    showStatus("clearResult", `‚úÖ ${deletedCount} data test berhasil dihapus`, "success");
                } else {
                    showStatus("clearResult", "‚ÑπÔ∏è Tidak ada data test yang ditemukan", "info");
                }
            } catch (error) {
                showStatus("clearResult", `‚ùå Error: ${error.message}`, "error");
            }
        }

        function checkConfig() {
            try {
                if (typeof firebaseConfig === 'undefined') {
                    showStatus("configResult", "‚ùå firebase-config.js belum loaded atau firebaseConfig tidak didefinisikan", "error");
                    return;
                }

                const configStr = JSON.stringify(firebaseConfig, null, 2);
                let status = "‚úÖ Firebase Config ditemukan:<br>";
                status += "<code>" + configStr.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "</code>";
                
                document.getElementById("configResult").innerHTML = `<div class="status success">${status}</div>`;
            } catch (error) {
                showStatus("configResult", `‚ùå Error: ${error.message}`, "error");
            }
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                testFirebaseConnection();
            }, 1000);
        });
    </script>
</body>
</html>
